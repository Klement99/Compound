<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compound Interest Calculator</title>
  <link rel="apple-touch-icon" href="icon.jpg">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background-color: #f3f4f6; font-family: Arial, sans-serif; }
    #chartContainer { max-width: 100%; height: 300px; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
  <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-md">
    <h1 class="text-2xl font-bold text-center mb-4">Compound Interest Calculator</h1>
    <form id="calcForm" class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">Initial Investment (R)</label>
        <input type="number" id="initialInvestment" value="0" min="0" step="0.01" class="mt-1 block w-full p-2 border rounded-md">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Years Invested</label>
        <input type="number" id="years" value="1" min="1" step="1" class="mt-1 block w-full p-2 border rounded-md">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Monthly Contribution (R)</label>
        <input type="number" id="monthlyContribution" value="0" min="0" step="0.01" class="mt-1 block w-full p-2 border rounded-md">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Annual Growth Rate (%)</label>
        <input type="number" id="rate" value="15" min="0" step="0.01" class="mt-1 block w-full p-2 border rounded-md">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Inflation Rate (%)</label>
        <input type="number" id="inflationRate" value="6" min="0" step="0.01" class="mt-1 block w-full p-2 border rounded-md">
      </div>
      <button type="button" onclick="calculate()" class="w-full bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700">Calculate</button>
    </form>
    <div id="results" class="mt-6 space-y-2 hidden">
      <h2 class="text-lg font-semibold text-center">Results</h2>
      <p class="text-center"><strong>Total Investment Value:</strong> <span id="totalValue"></span></p>
      <p class="text-center"><strong>Monthly Interest (End):</strong> <span id="monthlyInterest"></span></p>
      <p class="text-center"><strong>Future Buying Power (Total):</strong> <span id="totalRealValue"></span></p>
      <p class="text-center"><strong>Future Buying Power (Monthly Interest):</strong> <span id="monthlyRealInterest"></span></p>
    </div>
    <div id="chartContainer" class="mt-6">
      <canvas id="growthChart"></canvas>
    </div>
    <div id="yearlyTable" class="mt-6 hidden">
      <h2 class="text-lg font-semibold text-center">Yearly Breakdown</h2>
      <table class="w-full text-sm border border-gray-300">
        <thead class="bg-gray-100">
          <tr>
            <th class="p-2 border border-gray-300 text-center">Year</th>
            <th class="p-2 border border-gray-300 text-center">Total Value (R)</th>
            <th class="p-2 border border-gray-300 text-center">Monthly Interest (R)</th>
          </tr>
        </thead>
        <tbody id="tableBody" class="text-center"></tbody>
      </table>
    </div>
  </div>
  <script>
    let chart = null;

    // Function to format numbers with spaces (e.g., 1234567 -> R1 234 567)
    function formatNumber(num) {
      return 'R' + Math.round(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
    }

    function calculate() {
      const P = parseFloat(document.getElementById('initialInvestment').value);
      const t = parseFloat(document.getElementById('years').value);
      const PMT = parseFloat(document.getElementById('monthlyContribution').value);
      const r = parseFloat(document.getElementById('rate').value) / 100;
      const i = parseFloat(document.getElementById('inflationRate').value) / 100;
      const n = 12; // Monthly compounding

      // Compound interest with monthly contributions for final year
      const futureValue = P * Math.pow(1 + r/n, n*t) + PMT * ((Math.pow(1 + r/n, n*t) - 1) / (r/n));
      const monthlyInterest = futureValue * (r/12);
      const totalRealValue = futureValue / Math.pow(1 + i, t);
      const monthlyRealInterest = monthlyInterest / Math.pow(1 + i, t);

      // Display final results
      document.getElementById('totalValue').textContent = formatNumber(futureValue);
      document.getElementById('monthlyInterest').textContent = formatNumber(monthlyInterest);
      document.getElementById('totalRealValue').textContent = formatNumber(totalRealValue);
      document.getElementById('monthlyRealInterest').textContent = formatNumber(monthlyRealInterest);
      document.getElementById('results').classList.remove('hidden');

      // Generate chart data
      const labels = Array.from({length: t + 1}, (_, i) => i);
      const data = labels.map(year => {
        return P * Math.pow(1 + r/n, n*year) + PMT * ((Math.pow(1 + r/n, n*year) - 1) / (r/n));
      });

      // Update or create chart
      if (chart) chart.destroy();
      chart = new Chart(document.getElementById('growthChart'), {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Investment Growth (R)',
            data: data,
            borderColor: '#2563eb',
            fill: false
          }]
        },
        options: {
          responsive: true,
          scales: {
            x: { title: { display: true, text: 'Years' } },
            y: { title: { display: true, text: 'Value (R)' } }
          }
        }
      });

      // Generate yearly table
      const tableBody = document.getElementById('tableBody');
      tableBody.innerHTML = ''; // Clear previous table
      for (let year = 1; year <= t; year++) {
        const yearlyValue = P * Math.pow(1 + r/n, n*year) + PMT * ((Math.pow(1 + r/n, n*year) - 1) / (r/n));
        const yearlyInterest = yearlyValue * (r/12);
        const row = `<tr><td class="p-2 border border-gray-300">${year}</td><td class="p-2 border border-gray-300">${formatNumber(yearlyValue)}</td><td class="p-2 border border-gray-300">${formatNumber(yearlyInterest)}</td></tr>`;
        tableBody.innerHTML += row;
      }
      document.getElementById('yearlyTable').classList.remove('hidden');
    }
  </script>
</body>
</html>