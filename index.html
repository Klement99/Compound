<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compound Interest Calculator</title>
  <link rel="apple-touch-icon" href="icon.jpg">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background-color: #1f2937; font-family: Arial, sans-serif; }
    #chartContainer { max-width: 100%; height: 300px; }
    canvas { background-color: #000000; border-radius: 8px; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 bg-gray-900 text-white">
  <div class="bg-gray-800 p-6 rounded-lg shadow-lg w-full max-w-md">
    <h1 class="text-2xl font-bold text-center mb-4 text-white">Compound Interest Calculator</h1>
    <form id="calcForm" class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-300">Initial Investment (R)</label>
        <input type="number" id="initialInvestment" value="1400000" min="0" step="0.01" class="mt-1 block w-full p-2 border border-gray-600 rounded-md bg-gray-700 text-white">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-300">Years Invested</label>
        <input type="number" id="years" value="1" min="1" step="1" class="mt-1 block w-full p-2 border border-gray-600 rounded-md bg-gray-700 text-white">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-300">Monthly Contribution (R)</label>
        <input type="number" id="monthlyContribution" value="20000" min="0" step="0.01" class="mt-1 block w-full p-2 border border-gray-600 rounded-md bg-gray-700 text-white">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-300">Annual Growth Rate (%)</label>
        <input type="number" id="rate" value="15" min="0" step="0.01" class="mt-1 block w-full p-2 border border-gray-600 rounded-md bg-gray-700 text-white">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-300">Inflation Rate (%)</label>
        <input type="number" id="inflationRate" value="6" min="0" step="0.01" class="mt-1 block w-full p-2 border border-gray-600 rounded-md bg-gray-700 text-white">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-300">Marginal Tax Rate (%)</label>
        <input type="number" id="marginalTaxRate" value="45" min="0" max="45" step="0.01" class="mt-1 block w-full p-2 border border-gray-600 rounded-md bg-gray-700 text-white">
      </div>
      <button type="button" onclick="calculate()" class="w-full bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700">Calculate</button>
    </form>
    <div id="results" class="mt-6 space-y-2 hidden">
      <h2 class="text-lg font-semibold text-center text-white">Pre-Tax Results</h2>
      <p class="text-center"><strong>Investment Value:</strong> <span id="totalValue"></span></p>
      <p class="text-center"><strong>Monthly Interest (End):</strong> <span id="monthlyInterest"></span></p>
      <hr>
      <p class="text-center"><strong>Future Power (Total):</strong> <span id="totalRealValue"></span></p>
      <p class="text-center"><strong>Future Power (Interest):</strong> <span id="monthlyRealInterest"></span></p>
      <p class="text-center"><strong>Future Power Post-Tax (Total):</strong> <span id="postTaxRealTotal"></span></p>
      <hr>
      <h2 class="text-lg font-semibold text-center text-white mt-4">Post-Tax Results</h2>
      <p class="text-center"><strong>Total Invested:</strong> <span id="totalInvested"></span></p>
      <p class="text-center"><strong>Net Proceeds (Cash-Out):</strong> <span id="postTaxTotal"></span></p>
      <p class="text-center"><strong>Monthly Interest:</strong> <span id="postTaxMonthlyInterest"></span></p>
      <p class="text-center"><strong>Future Post-Tax (Interest):</strong> <span id="postTaxRealMonthlyInterest"></span></p>
      <hr>
      <p class="text-sm text-center text-gray-400 mt-2">Assumes CGT on lump-sum disposal (40% inclusion, R40k exclusion) & interest exemption (R23.8k/yr). Adjust marginal rate for your bracket.</p>
    </div>
    <div id="chartContainer" class="mt-6">
      <canvas id="growthChart"></canvas>
    </div>
    <div id="yearlyTable" class="mt-6 hidden">
      <h2 class="text-lg font-semibold text-center text-white">Yearly Breakdown</h2>
      <table class="w-full text-sm border border-gray-600">
        <thead class="bg-gray-700">
          <tr>
            <th class="p-2 border border-gray-600 text-center text-white">Year</th>
            <th class="p-2 border border-gray-600 text-center text-white">Total Value (R)</th>
            <th class="p-2 border border-gray-600 text-center text-white">Monthly Interest (R)</th>
            <th class="p-2 border border-gray-600 text-center text-white">Post-Tax Monthly Interest (R)</th>
          </tr>
        </thead>
        <tbody id="tableBody" class="text-center"></tbody>
      </table>
    </div>
  </div>
  <script>
    let chart = null;

    // Function to format numbers with spaces (e.g., 1234567 -> R1 234 567)
    function formatNumber(num) {
      return 'R' + Math.round(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
    }

    function calculate() {
      const P = parseFloat(document.getElementById('initialInvestment').value);
      const t = parseFloat(document.getElementById('years').value);
      const PMT = parseFloat(document.getElementById('monthlyContribution').value);
      const r = parseFloat(document.getElementById('rate').value) / 100;
      const i = parseFloat(document.getElementById('inflationRate').value) / 100;
      const marginalRate = parseFloat(document.getElementById('marginalTaxRate').value) / 100;
      const n = 12; // Monthly compounding
      const monthlyExemption = 23800 / 12; // R23.8k annual exemption / 12

      // Total invested (base cost)
      const totalInvested = P + PMT * n * t;

      // Compound interest with monthly contributions for final year
      const futureValue = P * Math.pow(1 + r/n, n*t) + PMT * ((Math.pow(1 + r/n, n*t) - 1) / (r/n));
      const monthlyInterest = futureValue * (r/12);
      const totalRealValue = futureValue / Math.pow(1 + i, t);
      const monthlyRealInterest = monthlyInterest / Math.pow(1 + i, t);

      // Post-tax calculations (SARS 2025 rules)
      // Total cash-out: CGT on gain
      const capitalGain = Math.max(0, futureValue - totalInvested);
      const netGainAfterExclusion = Math.max(0, capitalGain - 40000); // R40k annual exclusion
      const taxableGain = netGainAfterExclusion * 0.4; // 40% inclusion rate
      const cgtTax = taxableGain * marginalRate;
      const postTaxTotal = futureValue - cgtTax;
      const postTaxRealTotal = postTaxTotal / Math.pow(1 + i, t);

      // Monthly interest: Tax on interest income
      const taxableMonthlyInterest = Math.max(0, monthlyInterest - monthlyExemption);
      const taxOnMonthlyInterest = taxableMonthlyInterest * marginalRate;
      const postTaxMonthlyInterest = monthlyInterest - taxOnMonthlyInterest;
      const postTaxRealMonthlyInterest = postTaxMonthlyInterest / Math.pow(1 + i, t);

      // Display results
      document.getElementById('totalValue').textContent = formatNumber(futureValue);
      document.getElementById('monthlyInterest').textContent = formatNumber(monthlyInterest);
      document.getElementById('totalRealValue').textContent = formatNumber(totalRealValue);
      document.getElementById('monthlyRealInterest').textContent = formatNumber(monthlyRealInterest);
      document.getElementById('totalInvested').textContent = formatNumber(totalInvested);
      document.getElementById('postTaxTotal').textContent = formatNumber(postTaxTotal);
      document.getElementById('postTaxMonthlyInterest').textContent = formatNumber(postTaxMonthlyInterest);
      document.getElementById('postTaxRealTotal').textContent = formatNumber(postTaxRealTotal);
      document.getElementById('postTaxRealMonthlyInterest').textContent = formatNumber(postTaxRealMonthlyInterest);
      document.getElementById('results').classList.remove('hidden');

      // Generate chart data
      const labels = Array.from({length: t + 1}, (_, i) => i);
      const data = labels.map(year => {
        return P * Math.pow(1 + r/n, n*year) + PMT * ((Math.pow(1 + r/n, n*year) - 1) / (r/n));
      });

      // Update or create chart
      if (chart) chart.destroy();
      chart = new Chart(document.getElementById('growthChart'), {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Investment Growth (R)',
            data: data,
            borderColor: '#3b82f6',
            fill: false
          }]
        },
        options: {
          responsive: true,
          scales: {
            x: { title: { display: true, text: 'Years', color: '#d1d5db' }, ticks: { color: '#d1d5db' } },
            y: { title: { display: true, text: 'Value (R)', color: '#d1d5db' }, ticks: { color: '#d1d5db' } }
          },
          plugins: {
            legend: { labels: { color: '#d1d5db' } }
          }
        }
      });

      // Generate yearly table
      const tableBody = document.getElementById('tableBody');
      tableBody.innerHTML = ''; // Clear previous table
      for (let year = 1; year <= t; year++) {
        const yearlyValue = P * Math.pow(1 + r/n, n*year) + PMT * ((Math.pow(1 + r/n, n*year) - 1) / (r/n));
        const yearlyInterest = yearlyValue * (r/12);
        const taxableYearlyInterest = Math.max(0, yearlyInterest - monthlyExemption);
        const taxOnYearlyInterest = taxableYearlyInterest * marginalRate;
        const postTaxYearlyInterest = yearlyInterest - taxOnYearlyInterest;
        const row = `<tr><td class="p-2 border border-gray-600 text-white">${year}</td><td class="p-2 border border-gray-600 text-white">${formatNumber(yearlyValue)}</td><td class="p-2 border border-gray-600 text-white">${formatNumber(yearlyInterest)}</td><td class="p-2 border border-gray-600 text-white">${formatNumber(postTaxYearlyInterest)}</td></tr>`;
        tableBody.innerHTML += row;
      }
      document.getElementById('yearlyTable').classList.remove('hidden');
    }
  </script>
</body>
</html>
